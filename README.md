
# Высокочастотный Робот для Треугольного Арбитража (v3.0)

Этот проект представляет собой торгового робота, предназначенного для поиска и фиксации возможностей **треугольного арбитража** на криптовалютных биржах OKX и Bybit. Робот ищет неэффективности цен между тремя валютами на **одной и той же бирже**.

## Описание

Робот в реальном времени подключается к биржам OKX и Bybit с использованием технологии WebSocket, получая мгновенные обновления цен по всем необходимым торговым парам. Он анализирует эти данные, чтобы найти расхождения в ценах между тремя активами, которые позволяют начать с одной валюты (например, USDT), конвертировать ее через две другие и вернуться к исходной валюте с прибылью.

**Текущий статус:** Робот находится в режиме **тестирования стратегии треугольного арбитража**. Он логирует все найденные возможности, которые как минимум выходят в ноль после уплаты комиссий. Функции симуляции портфеля, динамического порога и ребалансировки временно отключены для упрощения отладки новой стратегии.

## Архитектура и Разработки

-   **Real-Time Движок:** Ядро робота построено на `asyncio` для обеспечения высокопроизводительной асинхронной работы.
-   **WebSocket Коннекторы:** Разработаны отдельные, отказоустойчивые коннекторы для OKX и Bybit (`connectors/`), использующие нативное подключение через библиотеку `websockets`.
-   **Автоматическое переподключение:** Коннекторы способны самостоятельно восстанавливать соединение в случае его обрыва.
-   **Стратегия Треугольного Арбитража:** Новая логика (`strategies/triangular_arbitrage_strategy.py`) рассчитывает два возможных пути арбитража для каждого треугольника, учитывая комиссии и глубину стакана (VWAP) на каждом из трех шагов.
-   **Централизованное логирование:** Все `print` вызовы заменены на профессиональный логгер, который пишет структурированную информацию в `robot.log` и `paper_trades.log`.
-   **Безопасная конфигурация:** API-ключи вынесены из кода в переменные окружения.

## Как использовать

1.  **Клонирование репозитория:**
    ```bash
    git clone https://github.com/richi8588/CRYPTO_ROBOT.git
    cd CRYPTO_ROBOT
    ```

2.  **Создание и активация виртуального окружения:**
    ```bash
    python3 -m venv venv
    source venv/bin/activate
    ```

3.  **Установка зависимостей:**
    ```bash
    pip install -r requirements.txt
    ```

4.  **Конфигурация:**
    Все основные параметры находятся в файле `config/settings.py`.

    *   **`TRIANGULAR_SETS`:** Определите наборы из трех пар, которые образуют треугольник. Например, `('BTC/USDT', 'ETH/BTC', 'ETH/USDT')`. Робот будет искать возможности внутри каждого такого набора на каждой бирже.
    *   **`TRADE_AMOUNT_BASE_CURRENCY`:** Начальная сумма в базовой валюте (например, USDT) для каждой попытки арбитража.
    *   **`MIN_PROFIT_THRESHOLD`:** Минимальный процент прибыли для логирования возможности. Установлен в `0.0` для логирования всех безубыточных или прибыльных возможностей.

    **API-ключи:** Для работы с приватными функциями бирж (например, проверка баланса, реальная торговля) необходимо установить API-ключи как переменные окружения. Это обеспечивает безопасность и предотвращает случайную публикацию ключей.

    Пример установки переменных окружения (для Linux/macOS):
    ```bash
    export OKX_API_KEY="ВАШ_КЛЮЧ_OKX"
    export OKX_SECRET_KEY="ВАШ_СЕКРЕТ_OKX"
    export OKX_PASSPHRASE="ВАША_ФРАЗА_OKX"
    export BYBIT_API_KEY="ВАШ_КЛЮЧ_BYBIT"
    export BYBIT_API_SECRET="ВАШ_СЕКРЕТ_BYBIT"
    ```

5.  **Запуск робота:**
    ```bash
    nohup python3 live_trader.py &
    ```

6.  **Мониторинг:**
    *   Следите за выводом в консоли или в файле `robot.log` для общих сообщений.
    *   Изучайте файл `paper_trades.log` для найденных возможностей треугольного арбитража. Ищите сообщения, начинающиеся с `TRIANGULAR ARB | ...`.

## Структура проекта

```
/
├── config/               # Файлы конфигурации
│   └── settings.py
├── connectors/           # Модули для подключения к биржам
│   ├── okx_connector.py
│   └── bybit_connector.py
├── strategies/           # Логика торговых стратегий
│   └── triangular_arbitrage_strategy.py # Новая стратегия
├── data/                 # Исторические данные (для бэктестинга)
├── logs/                 # Логи робота
├── live_trader.py        # Главный исполняемый файл
├── paper_trades.log      # Лог найденных возможностей
└── README.md             # Этот файл
```

## Возможные дальнейшие шаги

1.  **Анализ результатов:** Оцените частоту и прибыльность найденных возможностей треугольного арбитража.
2.  **Тонкая настройка:** Экспериментируйте с `TRADE_AMOUNT_BASE_CURRENCY` и `TRIANGULAR_SETS` в `config/settings.py`.
3.  **Внедрение полного функционала:** Если стратегия покажет себя жизнеспособной, можно будет вернуть функции симуляции портфеля, динамического порога и ребалансировки.
4.  **Реальная торговля:** После тщательного тестирования и уверенности в стратегии, можно будет перейти к реальной торговле.
